package etomica;

/** 
 * Class used to define an action on an AtomPair.
 * Can be passed to allPairs method of an AtomPair iterator to perform the action on 
 * all pairs generated by the iterator
 */
public abstract class AtomPairAction implements java.io.Serializable {
	public final Wrapper wrapper;
	public final OuterWrapper outerWrapper;
	public AtomPairAction(Space space) {
		wrapper = new Wrapper(new AtomPair(space));
		outerWrapper = new OuterWrapper();
	}
    public abstract void action(AtomPair pair);

/**
 * Wrapper class that makes an AtomPairAction suitable for input to an AtomIterator.
 * This is needed to enable an AtomPair iterator to perform an AtomPairAction on all its pairs.
 * Class is an AtomAction that contains the desired AtomPairAction. The first Atom is set
 *   externally before being fed into an AtomIterator, which iterates values for the
 *   second Atom of the pair; the pair is sent to the wrapped AtomPairAction on each iteration.
 */
    public final class Wrapper extends AtomAction {
        public final AtomPair pair;
        public Wrapper(AtomPair p) {pair = p;}
        public void actionPerformed(Atom a) {
            pair.atom2 = a;
            pair.reset();
            AtomPairAction.this.action(pair);
        }
        public void actionPerformed() {
            pair.reset();
            AtomPairAction.this.action(pair);
        }
    }//end of Wrapper
    
    public final class OuterWrapper extends AtomAction {
        public final IteratorDirective directive = new IteratorDirective(IteratorDirective.UP);
        public Atom innerBasis;
        public AtomIterator aiInner;
        public void actionPerformed(Atom a) {
            wrapper.pair.atom1 = a;
            aiInner.all(innerBasis, directive.set(a), wrapper);
        }
    }//end of OuterWrapper
            
    
}//end of AtomPairAction
